En el proceso de creación de la red 4G, se siguieron los siguientes pasos:

\begin{enumerate}
\item Descarga de la última versión de \textbf{Ubuntu}, \textbf{22.04 LTS}.
\item Grabación de la ISO en un pincho a través de \textbf{UNetbootin} y posterior instalación de Linux en el ordenador.
\item Instalación de los drivers de la \textit{Blade} siguiendo el manual de \textit{GitHub}:\\
 \url{https://github.com/Nuand/bladeRF/wiki/Getting-Started:-Linux}

\begin{lstlisting}
sudo add-apt-repository ppa:nuandllc/bladerf
sudo apt-get update
sudo apt-get install bladerf
\end{lstlisting}

\item Instalación de \textbf{srsran} siguiendo el manual de GitHub y las librerías \textbf{boost} y \textbf{libboost}:\\
\url{https://docs.srsran.com/projects/4g/en/latest/general/source/1_installation.html}\\
\url{https://docs.srsran.com/projects/4g/en/latest/getting_started.html}

\begin{lstlisting}
git clone https://github.com/srsRAN/srsRAN_4G.git
cd srsRAN_4G
mkdir build
cd build
cmake ../
make
make test
sudo make install
srsran_4g_install_configs.sh user
\end{lstlisting}

\item Modificación de los archivos de configuración que se encuentran en la ruta \textit{root/.config/srsran/}:
\begin{itemize}
	\item epc.conf
	\item enb.conf
	\item user_db.csv
\end{itemize}

En el archivo \textbf{enb.conf} se cambiaron los valores de \textbf{MCC} y \textbf{MNC} que están disponibles en la SIM, y se establecieron los valores correspondientes al \textbf{MCC} y \textbf{MNC} utilizados en el proyecto (\textbf{901-70}) para que se correspondan con el IMSI de las SIM. También se modificó el \textbf{dl_earfcn} utilizando una página web y se estableció el ancho de banda \textbf{n_prb} en \textbf{50}.\\

En el archivo \textbf{epc.conf} se modificaron los valores de \textbf{MCC} y \textbf{MNC} y se añadieron los nombres de la red con:
\begin{lstlisting}
    full_net_name= NOMBRE
    short_net_name= NOMBRE
\end{lstlisting}

En el archivo \textbf{user_db.csv} se creó un usuario nuevo con la siguiente información:
\begin{lstlisting}
    nombre, mil (Auth), IMSI (aparece en las hojas de las sims),
    KEY (aparece en las hojas de las sims), opc,
    OPC(aparece en las hojas de las sims), 9000,
    sqn (se pone automáticamente, pero pon números, por ejemplo todo a 0),
    7 (QCI), dynamic (IP_alloc)
\end{lstlisting}

\item Para crear la red y que funcione, se siguieron los siguientes pasos:
\begin{lstlisting}
    srepc_if_masq.sh enp0s25
    srsepc epc.conf
    srsenb enb.conf
\end{lstlisting}

\item Una vez obtenida la conexión a internet con la red 4G, nos bajamos los ficheros \textit{python} de control del coche para crear el servidor cloud e instalamos el servidor \textbf{MQTT Mosquitto}.

\item Modificamos el fichero de configuración /etc/mosquitto/mosquitto.conf con las siguientes líneas:
\begin{lstlisting}
	persistence true
	persistence_location /var/lib/mosquitto/
	allow_anonymous true
	listener 1883 10.0.128.176
	bind_interface enp0s25
	log_type information
	log_type warning
	log_type error
\end{lstlisting}

\item Para el correcto funcionamiento del servidor \textbf{MQTT Mosquitto} hay que suscribirse a los tópicos cada vez que lo ejecutamos con el siguiente comando:
\begin{lstlisting}
	mosquitto_sub -h localhost -t 1\#
\end{lstlisting}


\item Para el correcto funcionamiento del servidor \textbf{MQTT Mosquitto} hay que suscribirse a los tópicos cada vez que lo ejecutamos con el siguiente comando:
\begin{lstlisting}
	mosquitto_sub -h localhost -t 1\#
\end{lstlisting}

\item Por otra parte, en el dispositivo utilizado como cliente \textbf{MQTT Mosquitto} hay que suscribirse a los diferentes tópicos del vehículo, mostrando uno como ejemplo:
\begin{lstlisting}
	1/AM-Cloud
\end{lstlisting}
Y, publicarlos:
\begin{lstlisting}
	Topic: 1/command
	Message: AM-Cloud
\end{lstlisting}


\item Por último, para lanzar el servicio \textbf{MQTT Mosquitto} y otras acciones como relanzarlo, ver su estado o pararlo utilizamos los siguientes comandos:
\begin{lstlisting}
	sudo systemctl start mosquitto
	sudo systemctl status mosquitto
	sudo systemctl restart mosquitto
	sudo systemctl stop mosquitto
\end{lstlisting}

\end{enumerate}